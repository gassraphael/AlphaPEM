<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../../img/favicon.ico" />
    <title>Calibration modules - AlphaPEM</title>
    <link rel="stylesheet" href="../../../css/theme.css" />
    <link rel="stylesheet" href="../../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../../assets/_mkdocstrings.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Calibration modules";
        var mkdocs_page_input_path = "functions/modules/calibration_modules.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../../.." class="icon icon-home"> AlphaPEM
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Functions</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../../GUI/">GUI</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../main/">Main</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Calibration</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../calibration/experimental_values/">Experimental values</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../calibration/parameter_calibration/">Parameter calibration</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Configuration</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../configuration/current_densities/">Current densities</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../configuration/settings/">Settings</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Model</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../model/AlphaPEM/">AlphaPEM</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../model/auxiliaries/">Auxiliaries</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../model/cell_voltage/">Cell voltage</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../model/control/">Control</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../model/dif_eq/">Differentiel equations</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../model/flows/">Flows</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../model/heat_transfer/">Heat transfer</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" >Modules</a>
    <ul class="current">
                <li class="toctree-l2"><a class="reference internal" href="../auxiliaries_modules/">Auxiliaries modules</a>
                </li>
                <li class="toctree-l2 current"><a class="reference internal current" href="#">Calibration modules</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../dif_eq_modules/">Differential equations modules</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../display_modules/">Display modules</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../flows_modules/">Flows modules</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../GUI_modules/">GUI modules</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../heat_modules/">Heat modules</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../main_modules/">Main modules</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../settings_modules/">Settings modules</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../transitory_functions/">Transitory functions</a>
                </li>
    </ul>
                  </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../about/">About</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../..">AlphaPEM</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Functions</li>
          <li class="breadcrumb-item">Modules</li>
      <li class="breadcrumb-item active">Calibration modules</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="calibration-modules">Calibration modules</h1>


<div class="doc doc-object doc-module">



<a id="modules.calibration_modules"></a>
    <div class="doc doc-contents first">

        <p>This module contains some of the functions required for the parameter calibration.</p>








  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="modules.calibration_modules.calculate_simulation_error" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_simulation_error</span><span class="p">(</span><span class="n">Simulator_1</span><span class="p">,</span> <span class="n">U_exp_1</span><span class="p">,</span> <span class="n">i_exp_1</span><span class="p">,</span> <span class="n">Simulator_2</span><span class="p">,</span> <span class="n">U_exp_2</span><span class="p">,</span> <span class="n">i_exp_2</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>This function is used to calculate the simulation maximal error between the experimental and the simulated
polarization curves. Two simulations on different operating conditions and on the same stack, and so two set of
experimental data, are considered as it is the minimum amount of data which is required for the calibration.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>Simulator_1</code></b>
                  (<code>AlphaPEM object</code>)
              –
              <div class="doc-md-description">
                <p>PEM simulator which contains the simulation results for the first simulation.</p>
              </div>
            </li>
            <li>
              <b><code>U_exp_1</code></b>
                  (<code><span title="numpy.ndarray">ndarray</span></code>)
              –
              <div class="doc-md-description">
                <p>Experimental values of the voltage for the first simulation.</p>
              </div>
            </li>
            <li>
              <b><code>i_exp_1</code></b>
                  (<code><span title="numpy.ndarray">ndarray</span></code>)
              –
              <div class="doc-md-description">
                <p>Experimental values of the current density for the first simulation.</p>
              </div>
            </li>
            <li>
              <b><code>Simulator_2</code></b>
                  (<code>AlphaPEM object</code>)
              –
              <div class="doc-md-description">
                <p>PEM simulator which contains the simulation results for the second simulation.</p>
              </div>
            </li>
            <li>
              <b><code>U_exp_2</code></b>
                  (<code><span title="numpy.ndarray">ndarray</span></code>)
              –
              <div class="doc-md-description">
                <p>Experimental values of the voltage for the second simulation.</p>
              </div>
            </li>
            <li>
              <b><code>i_exp_2</code></b>
                  (<code><span title="numpy.ndarray">ndarray</span></code>)
              –
              <div class="doc-md-description">
                <p>Experimental values of the current density for the second simulation.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>sim_error</code></b>(                  <code>float</code>
)              –
              <div class="doc-md-description">
                <p>Maximum error between the experimental and the simulated polarization curves in percentage.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>modules/calibration_modules.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_simulation_error</span><span class="p">(</span><span class="n">Simulator_1</span><span class="p">,</span> <span class="n">U_exp_1</span><span class="p">,</span> <span class="n">i_exp_1</span><span class="p">,</span> <span class="n">Simulator_2</span><span class="p">,</span> <span class="n">U_exp_2</span><span class="p">,</span> <span class="n">i_exp_2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This function is used to calculate the simulation maximal error between the experimental and the simulated</span>
<span class="sd">    polarization curves. Two simulations on different operating conditions and on the same stack, and so two set of</span>
<span class="sd">    experimental data, are considered as it is the minimum amount of data which is required for the calibration.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Simulator_1 : AlphaPEM object</span>
<span class="sd">        PEM simulator which contains the simulation results for the first simulation.</span>
<span class="sd">    U_exp_1 : numpy.ndarray</span>
<span class="sd">        Experimental values of the voltage for the first simulation.</span>
<span class="sd">    i_exp_1 : numpy.ndarray</span>
<span class="sd">        Experimental values of the current density for the first simulation.</span>
<span class="sd">    Simulator_2 : AlphaPEM object</span>
<span class="sd">        PEM simulator which contains the simulation results for the second simulation.</span>
<span class="sd">    U_exp_2 : numpy.ndarray</span>
<span class="sd">        Experimental values of the voltage for the second simulation.</span>
<span class="sd">    i_exp_2 : numpy.ndarray</span>
<span class="sd">        Experimental values of the current density for the second simulation.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    sim_error : float</span>
<span class="sd">        Maximum error between the experimental and the simulated polarization curves in percentage.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Recovery of ifc_1</span>
    <span class="n">t1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Simulator_1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">])</span>
    <span class="n">n1</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">t1</span><span class="p">)</span>
    <span class="n">ifc_t_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n1</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n1</span><span class="p">):</span>  <span class="c1"># Creation of ifc_t</span>
        <span class="n">ifc_t_1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">Simulator_1</span><span class="o">.</span><span class="n">operating_inputs</span><span class="p">[</span><span class="s1">&#39;current_density&#39;</span><span class="p">](</span><span class="n">t1</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">Simulator_1</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>
    <span class="c1"># Recovery of ifc_2</span>
    <span class="n">t2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Simulator_2</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">])</span>
    <span class="n">n2</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">t2</span><span class="p">)</span>
    <span class="n">ifc_t_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n2</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n2</span><span class="p">):</span>  <span class="c1"># Creation of ifc_t</span>
        <span class="n">ifc_t_2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">Simulator_2</span><span class="o">.</span><span class="n">operating_inputs</span><span class="p">[</span><span class="s1">&#39;current_density&#39;</span><span class="p">](</span><span class="n">t2</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">Simulator_2</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>

    <span class="c1"># Polarisation curve point recovery after stack stabilisation for Simulator1</span>
    <span class="c1">#   Extraction of the parameters</span>
    <span class="c1">#       The initial time at zero current density for the stabilisation of the internal states.</span>
    <span class="n">delta_t_ini_pola_cali_1</span> <span class="o">=</span> <span class="n">Simulator_1</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;pola_current_for_cali_parameters&#39;</span><span class="p">][</span><span class="s1">&#39;delta_t_ini_pola_cali&#39;</span><span class="p">]</span>  <span class="c1"># (s).</span>
    <span class="c1">#       The loading time for one step current of the polarisation current density function.</span>
    <span class="n">delta_t_load_pola_cali_1</span> <span class="o">=</span> <span class="n">Simulator_1</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;pola_current_for_cali_parameters&#39;</span><span class="p">][</span><span class="s1">&#39;delta_t_load_pola_cali&#39;</span><span class="p">]</span>  <span class="c1"># (s).</span>
    <span class="c1">#       The breaking time for one step current, for the stabilisation of the internal states.</span>
    <span class="n">delta_t_break_pola_cali_1</span> <span class="o">=</span> <span class="n">Simulator_1</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;pola_current_for_cali_parameters&#39;</span><span class="p">][</span><span class="s1">&#39;delta_t_break_pola_cali&#39;</span><span class="p">]</span>  <span class="c1"># (s).</span>
    <span class="c1">#   Calculation</span>
    <span class="n">nb_loads1</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">i_exp_1</span><span class="p">)</span>  <span class="c1"># Number of load which are made</span>
    <span class="n">delta_t_cali_1</span> <span class="o">=</span> <span class="n">delta_t_load_pola_cali_1</span> <span class="o">+</span> <span class="n">delta_t_break_pola_cali_1</span>  <span class="c1"># s. It is the time of one load.</span>
    <span class="n">ifc_discretized1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nb_loads1</span><span class="p">)</span>
    <span class="n">Ucell_discretized1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nb_loads1</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nb_loads1</span><span class="p">):</span>
        <span class="n">t_load_1</span> <span class="o">=</span> <span class="n">delta_t_ini_pola_cali_1</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">delta_t_cali_1</span> <span class="c1"># time for measurement</span>
        <span class="n">idx1</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">t1</span> <span class="o">-</span> <span class="n">t_load_1</span><span class="p">))</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>  <span class="c1"># the corresponding index</span>
        <span class="n">ifc_discretized1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ifc_t_1</span><span class="p">[</span><span class="n">idx1</span><span class="p">]</span>  <span class="c1"># the last value at the end of each load</span>
        <span class="n">Ucell_discretized1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">Simulator_1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;Ucell&#39;</span><span class="p">][</span><span class="n">idx1</span><span class="p">]</span>  <span class="c1"># the last value at the end of each load</span>
    <span class="c1"># Polarisation curve point recovery after stack stabilisation for Simulator2</span>
    <span class="c1">#   Extraction of the parameters</span>
    <span class="c1">#       The initial time at zero current density for the stabilisation of the internal states.</span>
    <span class="n">delta_t_ini_pola_cali_2</span> <span class="o">=</span> <span class="n">Simulator_2</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;pola_current_for_cali_parameters&#39;</span><span class="p">][</span><span class="s1">&#39;delta_t_ini_pola_cali&#39;</span><span class="p">]</span>  <span class="c1"># (s).</span>
    <span class="c1">#       The loading time for one step current of the polarisation current density function.</span>
    <span class="n">delta_t_load_pola_cali_2</span> <span class="o">=</span> <span class="n">Simulator_2</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;pola_current_for_cali_parameters&#39;</span><span class="p">][</span><span class="s1">&#39;delta_t_load_pola_cali&#39;</span><span class="p">]</span>  <span class="c1"># (s).</span>
    <span class="c1">#       The breaking time for one step current, for the stabilisation of the internal states.</span>
    <span class="n">delta_t_break_pola_cali_2</span> <span class="o">=</span> <span class="n">Simulator_2</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;pola_current_for_cali_parameters&#39;</span><span class="p">][</span><span class="s1">&#39;delta_t_break_pola_cali&#39;</span><span class="p">]</span>  <span class="c1"># (s).</span>
    <span class="c1">#   Calculation</span>
    <span class="n">nb_loads2</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">i_exp_2</span><span class="p">)</span>  <span class="c1"># Number of load which are made</span>
    <span class="n">delta_t_cali_2</span> <span class="o">=</span> <span class="n">delta_t_load_pola_cali_2</span> <span class="o">+</span> <span class="n">delta_t_break_pola_cali_2</span>  <span class="c1"># s. It is the time of one load.</span>
    <span class="n">ifc_discretized2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nb_loads2</span><span class="p">)</span>
    <span class="n">Ucell_discretized2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nb_loads2</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nb_loads2</span><span class="p">):</span>
        <span class="n">t_load_2</span> <span class="o">=</span> <span class="n">delta_t_ini_pola_cali_2</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">delta_t_cali_2</span> <span class="c1"># time for measurement</span>
        <span class="n">idx2</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">t2</span> <span class="o">-</span> <span class="n">t_load_2</span><span class="p">))</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>  <span class="c1"># the corresponding index</span>
        <span class="n">ifc_discretized2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ifc_t_2</span><span class="p">[</span><span class="n">idx2</span><span class="p">]</span>  <span class="c1"># the last value at the end of each load</span>
        <span class="n">Ucell_discretized2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">Simulator_2</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;Ucell&#39;</span><span class="p">][</span><span class="n">idx2</span><span class="p">]</span>  <span class="c1"># the last value at the end of each load</span>

    <span class="c1"># Distance between the simulated and the experimental polarization curves.</span>
    <span class="n">sim_error</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Ucell_discretized1</span> <span class="o">-</span> <span class="n">U_exp_1</span><span class="p">)</span> <span class="o">/</span> <span class="n">U_exp_1</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
                     <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Ucell_discretized2</span> <span class="o">-</span> <span class="n">U_exp_2</span><span class="p">)</span> <span class="o">/</span> <span class="n">U_exp_2</span> <span class="o">*</span> <span class="mi">100</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span>  <span class="c1"># in %.</span>

    <span class="k">return</span> <span class="n">sim_error</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="modules.calibration_modules.parameter_bounds_for_calibration" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">parameter_bounds_for_calibration</span><span class="p">(</span><span class="n">type_fuel_cell</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>This function is used to determine the parameter bounds of the fuel cell model for the calibration when a
registered type_fuel_cell is considered.</p>


<details class="---parameters" open>
  <summary>Parameters</summary>
  <p>type_fuel_cell : str
           Type of fuel cell configuration.</p>
</details>

<details class="---returns" open>
  <summary>Returns</summary>
  <p>varbound : list
        List of the bounds on the parameters to calibrate. Each element is a list containing the minimum and
        maximum values of the parameter, and the type of the parameter ('real' or 'int').
   gene_space : list
        List of dictionaries used to define the bounds of the undetermined parameters for pygad. Each
        dictionary contains the 'low' and 'high' values for the parameter, and optionally a 'step' value for
        integer parameters.</p>
</details>
            <details class="quote">
              <summary>Source code in <code>modules/calibration_modules.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">parameter_bounds_for_calibration</span><span class="p">(</span><span class="n">type_fuel_cell</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This function is used to determine the parameter bounds of the fuel cell model for the calibration when a</span>
<span class="sd">    registered type_fuel_cell is considered.</span>

<span class="sd">       Parameters</span>
<span class="sd">       ----------</span>
<span class="sd">       type_fuel_cell : str</span>
<span class="sd">               Type of fuel cell configuration.</span>

<span class="sd">       Returns</span>
<span class="sd">       -------</span>
<span class="sd">       varbound : list</span>
<span class="sd">            List of the bounds on the parameters to calibrate. Each element is a list containing the minimum and</span>
<span class="sd">            maximum values of the parameter, and the type of the parameter (&#39;real&#39; or &#39;int&#39;).</span>
<span class="sd">       gene_space : list</span>
<span class="sd">            List of dictionaries used to define the bounds of the undetermined parameters for pygad. Each</span>
<span class="sd">            dictionary contains the &#39;low&#39; and &#39;high&#39; values for the parameter, and optionally a &#39;step&#39; value for</span>
<span class="sd">            integer parameters.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">type_fuel_cell</span> <span class="o">==</span> <span class="s2">&quot;ZSW-GenStack&quot;</span><span class="p">:</span>
        <span class="c1">#       Fuel cell physical parameters</span>
        <span class="n">Hacl_min</span><span class="p">,</span> <span class="n">Hacl_max</span> <span class="o">=</span> <span class="mf">6e-6</span><span class="p">,</span> <span class="mf">1e-5</span>  <span class="c1"># m. It is the thickness of the ACL.</span>
        <span class="n">Hccl_min</span><span class="p">,</span> <span class="n">Hccl_max</span> <span class="o">=</span> <span class="mf">1e-5</span><span class="p">,</span> <span class="mf">2e-5</span>  <span class="c1"># m. It is the thickness of the CCL.</span>
        <span class="n">Hmem_min</span><span class="p">,</span> <span class="n">Hmem_max</span> <span class="o">=</span> <span class="mf">1e-5</span><span class="p">,</span> <span class="mf">2e-5</span>  <span class="c1"># m. It is the thickness of the membrane.</span>
        <span class="n">epsilon_gdl_min</span><span class="p">,</span> <span class="n">epsilon_gdl_max</span> <span class="o">=</span> <span class="mf">0.696</span><span class="p">,</span> <span class="mf">0.880</span>  <span class="c1"># It is the anode/cathode GDL porosity, without units.</span>
        <span class="n">epsilon_mpl_min</span><span class="p">,</span> <span class="n">epsilon_mpl_max</span> <span class="o">=</span> <span class="mf">0.32</span><span class="p">,</span> <span class="mf">0.54</span>  <span class="c1"># It is the anode/cathode MPL porosity, without units.</span>
        <span class="n">epsilon_cl_min</span><span class="p">,</span> <span class="n">epsilon_cl_max</span> <span class="o">=</span> <span class="mf">0.40</span><span class="p">,</span> <span class="mf">0.60</span>  <span class="c1"># It is the anode/cathode MPL porosity, without units.</span>
        <span class="n">epsilon_mc_min</span><span class="p">,</span> <span class="n">epsilon_mc_max</span> <span class="o">=</span> <span class="mf">0.40</span><span class="p">,</span> <span class="mf">0.60</span>  <span class="c1"># It is the volume fraction of ionomer in the CL.</span>
        <span class="c1">#       Constants based on the interaction between water and the structure</span>
        <span class="n">e_min</span><span class="p">,</span> <span class="n">e_max</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span>  <span class="c1"># It is the capillary exponent, and should be an int number.</span>
        <span class="c1">#       Voltage polarization</span>
        <span class="n">i0_c_ref_min</span><span class="p">,</span> <span class="n">i0_c_ref_max</span> <span class="o">=</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="mi">80</span>  <span class="c1"># A.m-2.It is the reference exchange current density at the cathode.</span>
        <span class="n">kappa_co_min</span><span class="p">,</span> <span class="n">kappa_co_max</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mi">40</span>  <span class="c1"># A.m-2. It is the crossover correction coefficient.</span>
        <span class="n">kappa_c_min</span><span class="p">,</span> <span class="n">kappa_c_max</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mi">4</span>  <span class="c1"># It is the overpotential correction exponent.</span>
        <span class="c1">#       The bounds on liquid saturation coefficients are constrained to facilitate calibration.</span>
        <span class="n">a_slim_min</span><span class="p">,</span> <span class="n">a_slim_max</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.2</span>  <span class="c1"># It is one of the limit liquid saturation coefficients.</span>
        <span class="n">b_slim_min</span><span class="p">,</span> <span class="n">b_slim_max</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.4</span>  <span class="c1"># It is one of the limit liquid saturation coefficients.</span>
        <span class="n">a_switch_min</span><span class="p">,</span> <span class="n">a_switch_max</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.95</span>  <span class="c1"># It is one of the limit liquid saturation coefficients.</span>
        <span class="c1">#       Undetermined parameter which is not considered yet (require the use of EIS curves to be calibrated)</span>
        <span class="n">C_scl_min</span><span class="p">,</span> <span class="n">C_sl_max</span> <span class="o">=</span> <span class="mf">2e7</span><span class="p">,</span> <span class="mf">2e7</span>  <span class="c1"># F.m-3. It is the volumetric space-charge layer capacitance.</span>
        <span class="c1">#       Bounds gathering and type</span>
        <span class="n">varbound</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;epsilon_gdl&#39;</span><span class="p">,</span> <span class="n">epsilon_gdl_min</span><span class="p">,</span> <span class="n">epsilon_gdl_max</span><span class="p">,</span> <span class="s1">&#39;real&#39;</span><span class="p">],</span>
                    <span class="p">[</span><span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="n">e_min</span><span class="p">,</span> <span class="n">e_max</span><span class="p">,</span> <span class="s1">&#39;int&#39;</span><span class="p">],</span>
                    <span class="p">[</span><span class="s1">&#39;i0_c_ref&#39;</span><span class="p">,</span> <span class="n">i0_c_ref_min</span><span class="p">,</span> <span class="n">i0_c_ref_max</span><span class="p">,</span> <span class="s1">&#39;real&#39;</span><span class="p">],</span>
                    <span class="p">[</span><span class="s1">&#39;kappa_co&#39;</span><span class="p">,</span> <span class="n">kappa_co_min</span><span class="p">,</span> <span class="n">kappa_co_max</span><span class="p">,</span> <span class="s1">&#39;real&#39;</span><span class="p">],</span>
                    <span class="p">[</span><span class="s1">&#39;kappa_c&#39;</span><span class="p">,</span> <span class="n">kappa_c_min</span><span class="p">,</span> <span class="n">kappa_c_max</span><span class="p">,</span> <span class="s1">&#39;real&#39;</span><span class="p">]]</span>
        <span class="n">gene_space</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># List used to define the bounds of the undetermined parameters for pygad.</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">varbound</span><span class="p">)):</span>
            <span class="n">name</span><span class="p">,</span> <span class="n">min_val</span><span class="p">,</span> <span class="n">max_val</span><span class="p">,</span> <span class="n">type_val</span> <span class="o">=</span> <span class="n">varbound</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">type_val</span> <span class="o">==</span> <span class="s1">&#39;int&#39;</span><span class="p">:</span>
                <span class="n">gene_space</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;low&#39;</span><span class="p">:</span> <span class="n">min_val</span><span class="p">,</span> <span class="s1">&#39;high&#39;</span><span class="p">:</span> <span class="n">max_val</span><span class="p">,</span> <span class="s1">&#39;step&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">gene_space</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;low&#39;</span><span class="p">:</span> <span class="n">min_val</span><span class="p">,</span> <span class="s1">&#39;high&#39;</span><span class="p">:</span> <span class="n">max_val</span><span class="p">})</span>

    <span class="k">elif</span> <span class="n">type_fuel_cell</span> <span class="o">==</span> <span class="s2">&quot;EH-31_1.5&quot;</span> <span class="ow">or</span> <span class="n">type_fuel_cell</span> <span class="o">==</span> <span class="s2">&quot;EH-31_2.0&quot;</span> <span class="ow">or</span> <span class="n">type_fuel_cell</span> <span class="o">==</span> <span class="s2">&quot;EH-31_2.25&quot;</span> <span class="ow">or</span> \
            <span class="n">type_fuel_cell</span> <span class="o">==</span> <span class="s2">&quot;EH-31_2.5&quot;</span><span class="p">:</span>
        <span class="c1">#       Fuel cell physical parameters</span>
        <span class="n">Hacl_min</span><span class="p">,</span> <span class="n">Hacl_max</span> <span class="o">=</span> <span class="mf">8e-6</span><span class="p">,</span> <span class="mf">2e-5</span>  <span class="c1"># m. It is the thickness of the ACL.</span>
        <span class="n">Hmem_min</span><span class="p">,</span> <span class="n">Hmem_max</span> <span class="o">=</span> <span class="mf">1.5e-5</span><span class="p">,</span> <span class="mf">5e-5</span>  <span class="c1"># m. It is the thickness of the membrane.</span>
        <span class="n">epsilon_gdl_min</span><span class="p">,</span> <span class="n">epsilon_gdl_max</span> <span class="o">=</span> <span class="mf">0.50</span><span class="p">,</span> <span class="mf">0.90</span>  <span class="c1"># It is the anode/cathode GDL porosity, without units.</span>
        <span class="n">epsilon_mpl_min</span><span class="p">,</span> <span class="n">epsilon_mpl_max</span> <span class="o">=</span> <span class="mf">0.30</span><span class="p">,</span> <span class="mf">0.60</span>  <span class="c1"># It is the anode/cathode MPL porosity, without units.</span>
        <span class="n">epsilon_cl_min</span><span class="p">,</span> <span class="n">epsilon_cl_max</span> <span class="o">=</span> <span class="mf">0.12</span><span class="p">,</span> <span class="mf">0.50</span>  <span class="c1"># It is the anode/cathode MPL porosity, without units.</span>
        <span class="n">epsilon_mc_min</span><span class="p">,</span> <span class="n">epsilon_mc_max</span> <span class="o">=</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.40</span>  <span class="c1"># It is the volume fraction of ionomer in the CL.</span>
        <span class="n">epsilon_c_min</span><span class="p">,</span> <span class="n">epsilon_c_max</span> <span class="o">=</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.30</span>  <span class="c1"># It is the compression ratio of the GDL.</span>
        <span class="c1">#       Constants based on the interaction between water and the structure</span>
        <span class="n">e_min</span><span class="p">,</span> <span class="n">e_max</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span>  <span class="c1"># It is the capillary exponent, and should be an int number.</span>
        <span class="c1">#       Voltage polarization</span>
        <span class="n">i0_c_ref_min</span><span class="p">,</span> <span class="n">i0_c_ref_max</span> <span class="o">=</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="mi">80</span>  <span class="c1"># A.m-2.It is the reference exchange current density at the cathode.</span>
        <span class="n">kappa_co_min</span><span class="p">,</span> <span class="n">kappa_co_max</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mi">40</span>  <span class="c1"># A.m-2. It is the crossover correction coefficient.</span>
        <span class="n">kappa_c_min</span><span class="p">,</span> <span class="n">kappa_c_max</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mi">4</span>  <span class="c1"># It is the overpotential correction exponent.</span>
        <span class="c1">#       The bounds on liquid saturation coefficients are constrained to facilitate calibration.</span>
        <span class="n">a_slim_min</span><span class="p">,</span> <span class="n">a_slim_max</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.2</span>  <span class="c1"># It is one of the limit liquid saturation coefficients.</span>
        <span class="n">b_slim_min</span><span class="p">,</span> <span class="n">b_slim_max</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.4</span>  <span class="c1"># It is one of the limit liquid saturation coefficients.</span>
        <span class="n">a_switch_min</span><span class="p">,</span> <span class="n">a_switch_max</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.95</span>  <span class="c1"># It is one of the limit liquid saturation coefficients.</span>
        <span class="c1">#       Undetermined parameter which is not considered yet (require the use of EIS curves to be calibrated)</span>
        <span class="n">C_scl_min</span><span class="p">,</span> <span class="n">C_sl_max</span> <span class="o">=</span> <span class="mf">2e7</span><span class="p">,</span> <span class="mf">2e7</span>  <span class="c1"># F.m-3. It is the volumetric space-charge layer capacitance.</span>
        <span class="c1">#       Bounds gathering and type</span>
        <span class="n">varbound</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;Hacl&#39;</span><span class="p">,</span> <span class="n">Hacl_min</span><span class="p">,</span> <span class="n">Hacl_max</span><span class="p">,</span> <span class="s1">&#39;real&#39;</span><span class="p">],</span>
                    <span class="p">[</span><span class="s1">&#39;Hmem&#39;</span><span class="p">,</span> <span class="n">Hmem_min</span><span class="p">,</span> <span class="n">Hmem_max</span><span class="p">,</span> <span class="s1">&#39;real&#39;</span><span class="p">],</span>
                    <span class="p">[</span><span class="s1">&#39;epsilon_gdl&#39;</span><span class="p">,</span> <span class="n">epsilon_gdl_min</span><span class="p">,</span> <span class="n">epsilon_gdl_max</span><span class="p">,</span> <span class="s1">&#39;real&#39;</span><span class="p">],</span>
                    <span class="p">[</span><span class="s1">&#39;epsilon_mc&#39;</span><span class="p">,</span> <span class="n">epsilon_mc_min</span><span class="p">,</span> <span class="n">epsilon_mc_max</span><span class="p">,</span> <span class="s1">&#39;real&#39;</span><span class="p">],</span>
                    <span class="p">[</span><span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="n">e_min</span><span class="p">,</span> <span class="n">e_max</span><span class="p">,</span> <span class="s1">&#39;int&#39;</span><span class="p">],</span>
                    <span class="p">[</span><span class="s1">&#39;i0_c_ref&#39;</span><span class="p">,</span> <span class="n">i0_c_ref_min</span><span class="p">,</span> <span class="n">i0_c_ref_max</span><span class="p">,</span> <span class="s1">&#39;real&#39;</span><span class="p">],</span>
                    <span class="p">[</span><span class="s1">&#39;kappa_co&#39;</span><span class="p">,</span> <span class="n">kappa_co_min</span><span class="p">,</span> <span class="n">kappa_co_max</span><span class="p">,</span> <span class="s1">&#39;real&#39;</span><span class="p">],</span>
                    <span class="p">[</span><span class="s1">&#39;kappa_c&#39;</span><span class="p">,</span> <span class="n">kappa_c_min</span><span class="p">,</span> <span class="n">kappa_c_max</span><span class="p">,</span> <span class="s1">&#39;real&#39;</span><span class="p">]]</span>
        <span class="n">gene_space</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># List used to define the bounds of the undetermined parameters for pygad.</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">varbound</span><span class="p">)):</span>
            <span class="n">name</span><span class="p">,</span> <span class="n">min_val</span><span class="p">,</span> <span class="n">max_val</span><span class="p">,</span> <span class="n">type_val</span> <span class="o">=</span> <span class="n">varbound</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">type_val</span> <span class="o">==</span> <span class="s1">&#39;int&#39;</span><span class="p">:</span>
                <span class="n">gene_space</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;low&#39;</span><span class="p">:</span> <span class="n">min_val</span><span class="p">,</span> <span class="s1">&#39;high&#39;</span><span class="p">:</span> <span class="n">max_val</span><span class="p">,</span> <span class="s1">&#39;step&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">gene_space</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;low&#39;</span><span class="p">:</span> <span class="n">min_val</span><span class="p">,</span> <span class="s1">&#39;high&#39;</span><span class="p">:</span> <span class="n">max_val</span><span class="p">})</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;A correct type_fuel_cell should be given.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">varbound</span><span class="p">,</span> <span class="n">gene_space</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="modules.calibration_modules.parameters_for_calibration" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">parameters_for_calibration</span><span class="p">(</span><span class="n">type_fuel_cell</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>This function is used to determine the parameters of the fuel cell model for the calibration when a registered
type_fuel_cell is considered.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>type_fuel_cell</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <pre><code>Type of fuel cell configuration.
</code></pre>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>T_des</code></b>(                  <code>float</code>
)              –
              <div class="doc-md-description">
                <p>Desired fuel cell temperature in Kelvin.</p>
              </div>
            </li>
            <li>
<b><code>Pa_des</code></b>(                  <code>float</code>
)              –
              <div class="doc-md-description">
                <p>Desired anode pressure in Pascal.</p>
              </div>
            </li>
            <li>
<b><code>Pc_des</code></b>(                  <code>float</code>
)              –
              <div class="doc-md-description">
                <p>Desired cathode pressure in Pascal.</p>
              </div>
            </li>
            <li>
<b><code>Sa</code></b>(                  <code>float</code>
)              –
              <div class="doc-md-description">
                <p>Stoichiometric ratio of hydrogen.</p>
              </div>
            </li>
            <li>
<b><code>Sc</code></b>(                  <code>float</code>
)              –
              <div class="doc-md-description">
                <p>Stoichiometric ratio of oxygen.</p>
              </div>
            </li>
            <li>
<b><code>Phi_a_des</code></b>(                  <code>float</code>
)              –
              <div class="doc-md-description">
                <p>Desired anode relative humidity.</p>
              </div>
            </li>
            <li>
<b><code>Phi_c_des</code></b>(                  <code>float</code>
)              –
              <div class="doc-md-description">
                <p>Desired cathode relative humidity.</p>
              </div>
            </li>
            <li>
<b><code>i_max_pola</code></b>(                  <code>float</code>
)              –
              <div class="doc-md-description">
                <p>Maximum current density for the polarization curve.</p>
              </div>
            </li>
            <li>
<b><code>Aact</code></b>(                  <code>float</code>
)              –
              <div class="doc-md-description">
                <p>Active area of the cell in m².</p>
              </div>
            </li>
            <li>
<b><code>Hmem</code></b>(                  <code>float</code>
)              –
              <div class="doc-md-description">
                <p>Thickness of the membrane in m.</p>
              </div>
            </li>
            <li>
<b><code>Hacl</code></b>(                  <code>float</code>
)              –
              <div class="doc-md-description">
                <p>Thickness of the anode catalyst layer in m.</p>
              </div>
            </li>
            <li>
<b><code>Hccl</code></b>(                  <code>float</code>
)              –
              <div class="doc-md-description">
                <p>Thickness of the cathode catalyst layer in m.</p>
              </div>
            </li>
            <li>
<b><code>Hagc</code></b>(                  <code>float</code>
)              –
              <div class="doc-md-description">
                <p>Thickness of the anode gas channel in m.</p>
              </div>
            </li>
            <li>
<b><code>Hcgc</code></b>(                  <code>float</code>
)              –
              <div class="doc-md-description">
                <p>Thickness of the cathode gas channel in m.</p>
              </div>
            </li>
            <li>
<b><code>Wagc</code></b>(                  <code>float</code>
)              –
              <div class="doc-md-description">
                <p>Width of the gas anode channel in m.</p>
              </div>
            </li>
            <li>
<b><code>Wcgc</code></b>(                  <code>float</code>
)              –
              <div class="doc-md-description">
                <p>Width of the gas cathode channel in m.</p>
              </div>
            </li>
            <li>
<b><code>Lgc</code></b>(                  <code>float</code>
)              –
              <div class="doc-md-description">
                <p>Length of the gas channel in m.</p>
              </div>
            </li>
            <li>
<b><code>type_auxiliary</code></b>(                  <code>str</code>
)              –
              <div class="doc-md-description">
                <p>Type of auxiliary system.</p>
              </div>
            </li>
            <li>
<b><code>type_control</code></b>(                  <code>str</code>
)              –
              <div class="doc-md-description">
                <p>Type of control system.</p>
              </div>
            </li>
            <li>
<b><code>type_purge</code></b>(                  <code>str</code>
)              –
              <div class="doc-md-description">
                <p>Type of purge system.</p>
              </div>
            </li>
            <li>
<b><code>type_display</code></b>(                  <code>str</code>
)              –
              <div class="doc-md-description">
                <p>Type of display.</p>
              </div>
            </li>
            <li>
<b><code>type_plot</code></b>(                  <code>str</code>
)              –
              <div class="doc-md-description">
                <p>Type of plot.</p>
              </div>
            </li>
            <li>
<b><code>type_current</code></b>(                  <code>str</code>
)              –
              <div class="doc-md-description">
                <p>Type of current density function.</p>
              </div>
            </li>
            <li>
<b><code>current_density</code></b>(                  <code>function</code>
)              –
              <div class="doc-md-description">
                <p>Current density evolution over time. It is a function of time and parameters dictionary.</p>
              </div>
            </li>
            <li>
<b><code>step_current_parameters</code></b>(                  <code>dict</code>
)              –
              <div class="doc-md-description">
                <p>Parameters for the step current density. It is a dictionary containing:
- 'delta_t_ini_step': the initial time (in seconds) at zero current density for the stabilisation of the
internal states,
- 'delta_t_load_step': the loading time (in seconds) for the step current density function, from 0 to
i_step,
- 'delta_t_break_step': the time (in seconds) at i_step current density for the stabilisation of the
internal states,
- 'i_step': the current density (in A.m-2) for the step current density function,
- 'delta_t_dyn_step': the time (in seconds) for dynamic display of the step current density function.</p>
              </div>
            </li>
            <li>
<b><code>pola_current_parameters</code></b>(                  <code>dict</code>
)              –
              <div class="doc-md-description">
                <p>Parameters for the polarization current density. It is a dictionary containing:
- 'delta_t_ini_pola': the initial time (in seconds) at zero current density for the stabilisation of the
internal states,
- 'delta_t_load_pola': the loading time (in seconds) for one step current of the polarisation current
density function,
- 'delta_t_break_pola': the breaking time (in seconds) for one step current, for the stabilisation of the
internal states,
- 'delta_i_pola': the current density step (in A.m-2) for the polarisation current density function.
- 'i_max_pola': the maximum current density (in A.m-2) for the polarization curve.</p>
              </div>
            </li>
            <li>
<b><code>pola_current_for_cali_parameters</code></b>(                  <code>dict</code>
)              –
              <div class="doc-md-description">
                <p>Parameters for the polarization current density for calibration. It is a dictionary containing:
- 'delta_t_ini_pola_cali': the initial time (in seconds) at zero current density for the stabilisation of
the internal states,
- 'delta_t_load_pola_cali': the loading time (in seconds) for one step current of the polarisation current
density function,
- 'delta_t_break_pola_cali': the breaking time (in seconds) for one step current, for the stabilisation of
the internal states.</p>
              </div>
            </li>
            <li>
<b><code>i_EIS</code></b>(                  <code>float</code>
)              –
              <div class="doc-md-description">
                <p>Current for which a ratio_EIS perturbation is added.</p>
              </div>
            </li>
            <li>
<b><code>ratio_EIS</code></b>(                  <code>float</code>
)              –
              <div class="doc-md-description">
                <p>Value of the perturbation on the current density for building the EIS curve.</p>
              </div>
            </li>
            <li>
<b><code>t_EIS</code></b>(                  <code>tuple</code>
)              –
              <div class="doc-md-description">
                <p>EIS parameters. It is a tuple containing the initial EIS time after stack equilibrium 't0_EIS', a list of time
parameters which gives the beginning of each frequency change 't_new_start', the final time 'tf_EIS', a list of
time parameters which gives the estimated time for reaching equilibrium at each frequency 'delta_t_break_EIS',
and a list of time parameters which gives the estimated time for measuring the voltage response at each
frequency 'delta_t_measurement_EIS'.</p>
              </div>
            </li>
            <li>
<b><code>f_EIS</code></b>(                  <code>tuple</code>
)              –
              <div class="doc-md-description">
                <p>EIS parameters. It is a tuple containing the power of the initial frequency
'f_power_min': f_min = 10**f_power_min, the power of the final frequency 'f_power_max', the number of
frequencies tested 'nb_f' and the number of points calculated per specific period 'nb_points'.</p>
              </div>
            </li>
            <li>
<b><code>t_purge</code></b>(                  <code>tuple</code>
)              –
              <div class="doc-md-description">
                <p>Time parameters for purging the system.
It is the purge time interval 'purge_time' and the time between two purges 'delta_purge'.</p>
              </div>
            </li>
            <li>
<b><code>n_gdl</code></b>(                  <code>int</code>
)              –
              <div class="doc-md-description">
                <p>Number of points considered in the GDL.</p>
              </div>
            </li>
            <li>
<b><code>i_exp</code></b>(                  <code><span title="numpy.ndarray">ndarray</span></code>
)              –
              <div class="doc-md-description">
                <p>Experimental values of the current density.</p>
              </div>
            </li>
            <li>
<b><code>U_exp</code></b>(                  <code><span title="numpy.ndarray">ndarray</span></code>
)              –
              <div class="doc-md-description">
                <p>Experimental values of the voltage.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>modules/calibration_modules.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">parameters_for_calibration</span><span class="p">(</span><span class="n">type_fuel_cell</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This function is used to determine the parameters of the fuel cell model for the calibration when a registered</span>
<span class="sd">    type_fuel_cell is considered.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    type_fuel_cell : str</span>
<span class="sd">            Type of fuel cell configuration.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    T_des : float</span>
<span class="sd">            Desired fuel cell temperature in Kelvin.</span>
<span class="sd">    Pa_des : float</span>
<span class="sd">        Desired anode pressure in Pascal.</span>
<span class="sd">    Pc_des : float</span>
<span class="sd">        Desired cathode pressure in Pascal.</span>
<span class="sd">    Sa : float</span>
<span class="sd">        Stoichiometric ratio of hydrogen.</span>
<span class="sd">    Sc : float</span>
<span class="sd">        Stoichiometric ratio of oxygen.</span>
<span class="sd">    Phi_a_des : float</span>
<span class="sd">        Desired anode relative humidity.</span>
<span class="sd">    Phi_c_des : float</span>
<span class="sd">        Desired cathode relative humidity.</span>
<span class="sd">    i_max_pola : float</span>
<span class="sd">        Maximum current density for the polarization curve.</span>
<span class="sd">    Aact : float</span>
<span class="sd">        Active area of the cell in m².</span>
<span class="sd">    Hmem : float</span>
<span class="sd">        Thickness of the membrane in m.</span>
<span class="sd">    Hacl : float</span>
<span class="sd">        Thickness of the anode catalyst layer in m.</span>
<span class="sd">    Hccl : float</span>
<span class="sd">        Thickness of the cathode catalyst layer in m.</span>
<span class="sd">    Hagc : float</span>
<span class="sd">        Thickness of the anode gas channel in m.</span>
<span class="sd">    Hcgc : float</span>
<span class="sd">        Thickness of the cathode gas channel in m.</span>
<span class="sd">    Wagc : float</span>
<span class="sd">        Width of the gas anode channel in m.</span>
<span class="sd">    Wcgc : float</span>
<span class="sd">        Width of the gas cathode channel in m.</span>
<span class="sd">    Lgc : float</span>
<span class="sd">        Length of the gas channel in m.</span>
<span class="sd">    type_auxiliary : str</span>
<span class="sd">        Type of auxiliary system.</span>
<span class="sd">    type_control : str</span>
<span class="sd">        Type of control system.</span>
<span class="sd">    type_purge : str</span>
<span class="sd">        Type of purge system.</span>
<span class="sd">    type_display : str</span>
<span class="sd">        Type of display.</span>
<span class="sd">    type_plot : str</span>
<span class="sd">        Type of plot.</span>
<span class="sd">    type_current : str</span>
<span class="sd">        Type of current density function.</span>
<span class="sd">    current_density : function</span>
<span class="sd">        Current density evolution over time. It is a function of time and parameters dictionary.</span>
<span class="sd">    step_current_parameters : dict</span>
<span class="sd">        Parameters for the step current density. It is a dictionary containing:</span>
<span class="sd">        - &#39;delta_t_ini_step&#39;: the initial time (in seconds) at zero current density for the stabilisation of the</span>
<span class="sd">        internal states,</span>
<span class="sd">        - &#39;delta_t_load_step&#39;: the loading time (in seconds) for the step current density function, from 0 to</span>
<span class="sd">        i_step,</span>
<span class="sd">        - &#39;delta_t_break_step&#39;: the time (in seconds) at i_step current density for the stabilisation of the</span>
<span class="sd">        internal states,</span>
<span class="sd">        - &#39;i_step&#39;: the current density (in A.m-2) for the step current density function,</span>
<span class="sd">        - &#39;delta_t_dyn_step&#39;: the time (in seconds) for dynamic display of the step current density function.</span>
<span class="sd">    pola_current_parameters : dict</span>
<span class="sd">        Parameters for the polarization current density. It is a dictionary containing:</span>
<span class="sd">        - &#39;delta_t_ini_pola&#39;: the initial time (in seconds) at zero current density for the stabilisation of the</span>
<span class="sd">        internal states,</span>
<span class="sd">        - &#39;delta_t_load_pola&#39;: the loading time (in seconds) for one step current of the polarisation current</span>
<span class="sd">        density function,</span>
<span class="sd">        - &#39;delta_t_break_pola&#39;: the breaking time (in seconds) for one step current, for the stabilisation of the</span>
<span class="sd">        internal states,</span>
<span class="sd">        - &#39;delta_i_pola&#39;: the current density step (in A.m-2) for the polarisation current density function.</span>
<span class="sd">        - &#39;i_max_pola&#39;: the maximum current density (in A.m-2) for the polarization curve.</span>
<span class="sd">    pola_current_for_cali_parameters : dict</span>
<span class="sd">        Parameters for the polarization current density for calibration. It is a dictionary containing:</span>
<span class="sd">        - &#39;delta_t_ini_pola_cali&#39;: the initial time (in seconds) at zero current density for the stabilisation of</span>
<span class="sd">        the internal states,</span>
<span class="sd">        - &#39;delta_t_load_pola_cali&#39;: the loading time (in seconds) for one step current of the polarisation current</span>
<span class="sd">        density function,</span>
<span class="sd">        - &#39;delta_t_break_pola_cali&#39;: the breaking time (in seconds) for one step current, for the stabilisation of</span>
<span class="sd">        the internal states.</span>
<span class="sd">    i_EIS : float</span>
<span class="sd">        Current for which a ratio_EIS perturbation is added.</span>
<span class="sd">    ratio_EIS : float</span>
<span class="sd">        Value of the perturbation on the current density for building the EIS curve.</span>
<span class="sd">    t_EIS : tuple</span>
<span class="sd">        EIS parameters. It is a tuple containing the initial EIS time after stack equilibrium &#39;t0_EIS&#39;, a list of time</span>
<span class="sd">        parameters which gives the beginning of each frequency change &#39;t_new_start&#39;, the final time &#39;tf_EIS&#39;, a list of</span>
<span class="sd">        time parameters which gives the estimated time for reaching equilibrium at each frequency &#39;delta_t_break_EIS&#39;,</span>
<span class="sd">        and a list of time parameters which gives the estimated time for measuring the voltage response at each</span>
<span class="sd">        frequency &#39;delta_t_measurement_EIS&#39;.</span>
<span class="sd">    f_EIS : tuple</span>
<span class="sd">        EIS parameters. It is a tuple containing the power of the initial frequency</span>
<span class="sd">        &#39;f_power_min&#39;: f_min = 10**f_power_min, the power of the final frequency &#39;f_power_max&#39;, the number of</span>
<span class="sd">        frequencies tested &#39;nb_f&#39; and the number of points calculated per specific period &#39;nb_points&#39;.</span>
<span class="sd">    t_purge : tuple</span>
<span class="sd">        Time parameters for purging the system.</span>
<span class="sd">        It is the purge time interval &#39;purge_time&#39; and the time between two purges &#39;delta_purge&#39;.</span>
<span class="sd">    n_gdl : int</span>
<span class="sd">        Number of points considered in the GDL.</span>
<span class="sd">    i_exp : numpy.ndarray</span>
<span class="sd">        Experimental values of the current density.</span>
<span class="sd">    U_exp : numpy.ndarray</span>
<span class="sd">        Experimental values of the voltage.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">type_fuel_cell</span> <span class="o">==</span> <span class="s2">&quot;ZSW-GenStack&quot;</span><span class="p">:</span>
        <span class="c1"># Given values by the author</span>
        <span class="c1">#       Operating inputs</span>
        <span class="n">T_des</span> <span class="o">=</span> <span class="mi">68</span> <span class="o">+</span> <span class="mf">273.15</span>  <span class="c1"># K. It is the temperature of the fuel cell.</span>
        <span class="n">Sa</span><span class="p">,</span> <span class="n">Sc</span> <span class="o">=</span> <span class="mf">1.6</span><span class="p">,</span> <span class="mf">1.6</span>  <span class="c1"># It is the stoichiometric ratio (of hydrogen and oxygen).</span>
        <span class="n">Phi_a_des</span><span class="p">,</span> <span class="n">Phi_c_des</span> <span class="o">=</span> <span class="mf">39.8</span><span class="p">,</span> <span class="mi">50</span>  <span class="c1"># It is the desired relative humidity.</span>
        <span class="n">Pa_des</span><span class="p">,</span> <span class="n">Pc_des</span> <span class="o">=</span> <span class="mf">2.2e5</span><span class="p">,</span> <span class="mf">2.0e5</span>  <span class="c1"># Pa. It is the desired pressure of the fuel gas (at the anode/cathode).</span>
        <span class="c1">#       Fuel cell physical parameters</span>
        <span class="n">Aact</span> <span class="o">=</span> <span class="mf">2.7972e-2</span>  <span class="c1"># m². It is the active area of the catalyst layer.</span>
        <span class="n">Hagc</span> <span class="o">=</span> <span class="mf">2.3e-4</span>  <span class="c1"># m. It is the thickness of the anode gas channel.</span>
        <span class="n">Hcgc</span> <span class="o">=</span> <span class="mf">3e-4</span>  <span class="c1"># m. It is the thickness of the cathode gas channel.</span>
        <span class="n">Wagc</span> <span class="o">=</span> <span class="mf">4.3e-4</span>  <span class="c1"># m. It is the width of the anode gas channel.</span>
        <span class="n">Wcgc</span> <span class="o">=</span> <span class="mf">5.32e-4</span>  <span class="c1"># m. It is the width of the cathode gas channel.</span>
        <span class="n">Lgc</span> <span class="o">=</span> <span class="mf">23.31</span>  <span class="c1"># m. It is the length of the gas channel.</span>
        <span class="c1">#       Fuel cell undetermined physical parameters.</span>
        <span class="n">Hgdl</span> <span class="o">=</span> <span class="mf">1.27e-4</span>  <span class="c1"># m. It is the thickness of the gas diffusion layer.</span>
        <span class="n">Hmpl</span> <span class="o">=</span> <span class="mf">7e-5</span>  <span class="c1"># m. It is the thickness of the microporous layer.</span>
        <span class="n">epsilon_c</span> <span class="o">=</span> <span class="mf">0.2</span>  <span class="c1"># It is the compression ratio of the GDL.</span>

        <span class="c1"># Estimated undetermined parameters for the initialisation</span>
        <span class="c1">#   Gas diffusion layer</span>
        <span class="n">epsilon_gdl</span> <span class="o">=</span> <span class="mf">0.788</span>  <span class="c1"># It is the anode/cathode GDL porosity.</span>
        <span class="n">epsilon_mpl</span> <span class="o">=</span> <span class="mf">0.425</span>  <span class="c1"># It is the porosity of the microporous layer.</span>
        <span class="c1">#   Catalyst layer</span>
        <span class="n">Hacl</span> <span class="o">=</span> <span class="mf">8e-6</span>  <span class="c1"># m. It is the thickness of the anode catalyst layer.</span>
        <span class="n">Hccl</span> <span class="o">=</span> <span class="mf">1.7e-5</span>  <span class="c1"># m. It is the thickness of the cathode catalyst layer.</span>
        <span class="n">epsilon_cl</span> <span class="o">=</span> <span class="mf">0.5</span>  <span class="c1"># It is the porosity of the microporous layer.</span>
        <span class="n">epsilon_mc</span> <span class="o">=</span> <span class="mf">0.5</span>  <span class="c1"># It is the volume fraction of ionomer in the CL.</span>
        <span class="c1">#   Membrane</span>
        <span class="n">Hmem</span> <span class="o">=</span> <span class="mf">1.5e-5</span>  <span class="c1"># m. It is the thickness of the membrane.</span>
        <span class="c1">#   Interaction parameters between water and PEMFC structure</span>
        <span class="n">e</span> <span class="o">=</span> <span class="mf">3.0</span>  <span class="c1"># It is the capillary exponent</span>
        <span class="c1">#   Voltage polarization</span>
        <span class="n">i0_c_ref</span> <span class="o">=</span> <span class="mf">14.86</span>  <span class="c1"># A.m-2.It is the reference exchange current density at the cathode.</span>
        <span class="n">kappa_co</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># mol.m-1.s-1.Pa-1. It is the crossover correction coefficient.</span>
        <span class="n">kappa_c</span> <span class="o">=</span> <span class="mf">0.6386</span>  <span class="c1"># It is the overpotential correction exponent.</span>
        <span class="n">a_slim</span><span class="p">,</span> <span class="n">b_slim</span><span class="p">,</span> <span class="n">a_switch</span> <span class="o">=</span> <span class="mf">0.05553</span><span class="p">,</span> <span class="mf">0.10514</span><span class="p">,</span> <span class="mf">0.63654</span>  <span class="c1"># It is the limit liquid saturation coefficients.</span>
        <span class="n">C_scl</span> <span class="o">=</span> <span class="mf">2e7</span>  <span class="c1"># F.m-3. It is the volumetric space-charge layer capacitance.</span>

        <span class="c1"># Algorithm parameters for polarization curve generation</span>
        <span class="n">type_auxiliary</span> <span class="o">=</span> <span class="s2">&quot;forced-convective_cathode_with_flow-through_anode&quot;</span>
        <span class="n">type_control</span> <span class="o">=</span> <span class="s2">&quot;no_control&quot;</span>
        <span class="n">type_purge</span> <span class="o">=</span> <span class="s2">&quot;no_purge&quot;</span>
        <span class="n">type_display</span> <span class="o">=</span> <span class="s2">&quot;no_display&quot;</span>
        <span class="n">type_plot</span> <span class="o">=</span> <span class="s2">&quot;fixed&quot;</span>
        <span class="n">type_current</span> <span class="o">=</span> <span class="s2">&quot;polarization_for_cali&quot;</span>
        <span class="n">current_density</span> <span class="o">=</span> <span class="n">polarization_current_for_calibration</span>
        <span class="n">delta_t_ini_step</span> <span class="o">=</span> <span class="mi">120</span> <span class="o">*</span> <span class="mi">60</span>  <span class="c1"># (s). Initial time at zero current density for the stabilisation of the internal states.</span>
        <span class="n">delta_t_load_step</span> <span class="o">=</span> <span class="mf">1e-15</span>  <span class="c1"># (s). Loading time for the step current density function, from 0 to i_step.</span>
        <span class="n">delta_t_break_step</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># (s). Time at i_step current density for the stabilisation of the internal states.</span>
        <span class="n">i_step</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># (A.m-2). Current density for the step current density function.</span>
        <span class="n">step_current_parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;delta_t_ini_step&#39;</span><span class="p">:</span> <span class="n">delta_t_ini_step</span><span class="p">,</span> <span class="s1">&#39;delta_t_load_step&#39;</span><span class="p">:</span> <span class="n">delta_t_load_step</span><span class="p">,</span>
                                   <span class="s1">&#39;delta_t_break_step&#39;</span><span class="p">:</span> <span class="n">delta_t_break_step</span><span class="p">,</span> <span class="s1">&#39;i_step&#39;</span><span class="p">:</span> <span class="n">i_step</span><span class="p">}</span>
        <span class="n">delta_t_ini_pola</span> <span class="o">=</span> <span class="mi">30</span> <span class="o">*</span> <span class="mi">60</span>  <span class="c1"># (s). Initial time at zero current density for the stabilisation of the internal states.</span>
        <span class="n">delta_t_load_pola</span> <span class="o">=</span> <span class="mi">30</span>  <span class="c1"># (s). Loading time for one step current of the polarisation current density function.</span>
        <span class="n">delta_t_break_pola</span> <span class="o">=</span> <span class="mi">15</span> <span class="o">*</span> <span class="mi">60</span>  <span class="c1"># (s). Breaking time for one step current, for the stabilisation of the internal states.</span>
        <span class="n">delta_i_pola</span> <span class="o">=</span> <span class="mf">0.05e4</span>  <span class="c1"># (A.m-2). Current density step for the polarisation current density function.</span>
        <span class="n">i_max_pola</span> <span class="o">=</span> <span class="mf">1.7e4</span>  <span class="c1"># (A.m-2). It is the maximum current density for the polarization curve.</span>
        <span class="n">pola_current_parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;delta_t_ini_pola&#39;</span><span class="p">:</span> <span class="n">delta_t_ini_pola</span><span class="p">,</span> <span class="s1">&#39;delta_t_load_pola&#39;</span><span class="p">:</span> <span class="n">delta_t_load_pola</span><span class="p">,</span>
                                   <span class="s1">&#39;delta_t_break_pola&#39;</span><span class="p">:</span> <span class="n">delta_t_break_pola</span><span class="p">,</span> <span class="s1">&#39;delta_i_pola&#39;</span><span class="p">:</span> <span class="n">delta_i_pola</span><span class="p">,</span>
                                   <span class="s1">&#39;i_max_pola&#39;</span><span class="p">:</span> <span class="n">i_max_pola</span><span class="p">}</span>
        <span class="n">delta_t_ini_pola_cali</span> <span class="o">=</span> <span class="mi">60</span>  <span class="c1"># (s). Initial time at zero current density for the stabilisation of the internal states.</span>
        <span class="n">delta_t_load_pola_cali</span> <span class="o">=</span> <span class="mi">30</span>  <span class="c1"># (s). Loading time for one step current of the polarisation current density function.</span>
        <span class="n">delta_t_break_pola_cali</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="mi">60</span>  <span class="c1"># (s). Breaking time for one step current, for the stabilisation of the internal states.</span>
        <span class="n">pola_current_for_cali_parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;delta_t_ini_pola_cali&#39;</span><span class="p">:</span> <span class="n">delta_t_ini_pola_cali</span><span class="p">,</span>
                                            <span class="s1">&#39;delta_t_load_pola_cali&#39;</span><span class="p">:</span> <span class="n">delta_t_load_pola_cali</span><span class="p">,</span>
                                            <span class="s1">&#39;delta_t_break_pola_cali&#39;</span><span class="p">:</span> <span class="n">delta_t_break_pola_cali</span><span class="p">}</span>
        <span class="n">i_EIS</span><span class="p">,</span> <span class="n">ratio_EIS</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>  <span class="c1"># (A/m², ). i_EIS is the current for which a ratio_EIS perturbation is added.</span>
        <span class="n">f_EIS</span><span class="p">,</span> <span class="n">t_EIS</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>  <span class="c1"># It is the EIS parameters.</span>
        <span class="n">t_purge</span> <span class="o">=</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mi">15</span>  <span class="c1"># s It is the purge time and the distance between two purges.</span>
        <span class="n">n_gdl</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">Hgdl</span> <span class="o">/</span> <span class="n">Hacl</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)</span>  <span class="c1"># It is the number of model points placed inside each GDL.</span>

    <span class="k">elif</span> <span class="n">type_fuel_cell</span> <span class="o">==</span> <span class="s2">&quot;EH-31_1.5&quot;</span> <span class="ow">or</span> <span class="n">type_fuel_cell</span> <span class="o">==</span> <span class="s2">&quot;EH-31_2.0&quot;</span> <span class="ow">or</span> <span class="n">type_fuel_cell</span> <span class="o">==</span> <span class="s2">&quot;EH-31_2.25&quot;</span> <span class="ow">or</span> \
            <span class="n">type_fuel_cell</span> <span class="o">==</span> <span class="s2">&quot;EH-31_2.5&quot;</span><span class="p">:</span>
        <span class="c1"># Given values by the author</span>
        <span class="c1">#       Operating inputs</span>
        <span class="n">T_des</span> <span class="o">=</span> <span class="mi">74</span> <span class="o">+</span> <span class="mf">273.15</span>  <span class="c1"># K. It is the temperature of the fuel cell.</span>
        <span class="n">Sa</span><span class="p">,</span> <span class="n">Sc</span> <span class="o">=</span> <span class="mf">1.2</span><span class="p">,</span> <span class="mf">2.0</span>  <span class="c1"># It is the stoichiometric ratio (of hydrogen and oxygen).</span>
        <span class="n">Phi_a_des</span><span class="p">,</span> <span class="n">Phi_c_des</span> <span class="o">=</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.6</span>  <span class="c1"># It is the desired relative humidity.</span>
        <span class="k">if</span> <span class="n">type_fuel_cell</span> <span class="o">==</span> <span class="s2">&quot;EH-31_1.5&quot;</span><span class="p">:</span>
            <span class="n">Pa_des</span><span class="p">,</span> <span class="n">Pc_des</span> <span class="o">=</span> <span class="mf">1.5e5</span><span class="p">,</span> <span class="mf">1.5e5</span>  <span class="c1"># Pa. It is the desired pressure of the fuel gas (at the anode/cathode).</span>
        <span class="k">elif</span> <span class="n">type_fuel_cell</span> <span class="o">==</span> <span class="s2">&quot;EH-31_2.0&quot;</span><span class="p">:</span>
            <span class="n">Pa_des</span><span class="p">,</span> <span class="n">Pc_des</span> <span class="o">=</span> <span class="mf">2.0e5</span><span class="p">,</span> <span class="mf">2.0e5</span>  <span class="c1"># Pa. It is the desired pressure of the fuel gas (at the anode/cathode).</span>
        <span class="k">elif</span> <span class="n">type_fuel_cell</span> <span class="o">==</span> <span class="s2">&quot;EH-31_2.25&quot;</span><span class="p">:</span>
            <span class="n">Pa_des</span><span class="p">,</span> <span class="n">Pc_des</span> <span class="o">=</span> <span class="mf">2.25e5</span><span class="p">,</span> <span class="mf">2.25e5</span>  <span class="c1"># Pa. It is the desired pressure of the fuel gas (at the anode/cathode).</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># type_fuel_cell == &quot;EH-31_2.5&quot;:</span>
            <span class="n">Pa_des</span><span class="p">,</span> <span class="n">Pc_des</span> <span class="o">=</span> <span class="mf">2.5e5</span><span class="p">,</span> <span class="mf">2.5e5</span>  <span class="c1"># Pa. It is the desired pressure of the fuel gas (at the anode/cathode).</span>
        <span class="c1">#       Fuel cell physical parameters</span>
        <span class="n">Aact</span> <span class="o">=</span> <span class="mf">8.5e-3</span>  <span class="c1"># m². It is the active area of the catalyst layer.</span>
        <span class="n">Wagc</span> <span class="o">=</span> <span class="mf">4.5e-4</span>  <span class="c1"># m. It is the width of the anode gas channel.</span>
        <span class="n">Wcgc</span> <span class="o">=</span> <span class="n">Wagc</span>  <span class="c1"># m. It is the width of the cathode gas channel.</span>
        <span class="n">Lgc</span> <span class="o">=</span> <span class="mf">9.67</span>  <span class="c1"># m. It is the length of the gas channel.</span>

        <span class="c1"># Extrapolated physical parameters</span>
        <span class="n">Hgdl</span> <span class="o">=</span> <span class="mf">2e-4</span>  <span class="c1"># m. It is the thickness of the gas diffusion layer.</span>
        <span class="n">Hmpl</span> <span class="o">=</span> <span class="mf">3e-5</span>  <span class="c1"># m. It is the thickness of the microporous layer.</span>
        <span class="n">epsilon_mpl</span> <span class="o">=</span> <span class="mf">0.4</span>  <span class="c1"># It is the porosity of the microporous layer.</span>
        <span class="n">Hagc</span> <span class="o">=</span> <span class="mf">5e-4</span>  <span class="c1"># m. It is the thickness of the anode gas channel.</span>
        <span class="n">Hcgc</span> <span class="o">=</span> <span class="n">Hagc</span>  <span class="c1"># m. It is the thickness of the cathode gas channel.</span>

        <span class="c1"># Estimated undetermined parameters for the initialisation</span>
        <span class="c1">#   Gas diffusion layer</span>
        <span class="n">epsilon_gdl</span> <span class="o">=</span> <span class="mf">0.7943</span>  <span class="c1"># It is the anode/cathode GDL porosity.</span>
        <span class="n">epsilon_c</span> <span class="o">=</span> <span class="mf">0.2</span>  <span class="c1"># It is the compression ratio of the GDL.</span>
        <span class="c1">#   Catalyst layer</span>
        <span class="n">Hacl</span> <span class="o">=</span> <span class="mf">8.089e-6</span>  <span class="c1"># m. It is the thickness of the anode catalyst layer.</span>
        <span class="n">Hccl</span> <span class="o">=</span> <span class="n">Hacl</span>  <span class="c1"># m. It is the thickness of the cathode catalyst layer.</span>
        <span class="n">epsilon_mc</span> <span class="o">=</span> <span class="mf">0.2111</span>  <span class="c1"># It is the volume fraction of ionomer in the CL.</span>
        <span class="c1">#   Membrane</span>
        <span class="n">Hmem</span> <span class="o">=</span> <span class="mf">1.5e-5</span>  <span class="c1"># m. It is the thickness of the membrane.</span>
        <span class="c1">#   Interaction parameters between water and PEMFC structure</span>
        <span class="n">e</span> <span class="o">=</span> <span class="mf">3.0</span>  <span class="c1"># It is the capillary exponent</span>
        <span class="c1">#   Voltage polarization</span>
        <span class="n">i0_c_ref</span> <span class="o">=</span> <span class="mf">14.86</span>  <span class="c1"># A.m-2.It is the reference exchange current density at the cathode.</span>
        <span class="n">kappa_co</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># mol.m-1.s-1.Pa-1. It is the crossover correction coefficient.</span>
        <span class="n">kappa_c</span> <span class="o">=</span> <span class="mf">0.6386</span>  <span class="c1"># It is the overpotential correction exponent.</span>
        <span class="n">a_slim</span><span class="p">,</span> <span class="n">b_slim</span><span class="p">,</span> <span class="n">a_switch</span> <span class="o">=</span> <span class="mf">0.05553</span><span class="p">,</span> <span class="mf">0.10514</span><span class="p">,</span> <span class="mf">0.63654</span>  <span class="c1"># It is the limit liquid saturation coefficients.</span>
        <span class="n">C_scl</span> <span class="o">=</span> <span class="mf">2e7</span>  <span class="c1"># F.m-3. It is the volumetric space-charge layer capacitance.</span>

        <span class="c1"># Algorithm parameters for polarization curve generation</span>
        <span class="n">type_auxiliary</span> <span class="o">=</span> <span class="s2">&quot;forced-convective_cathode_with_flow-through_anode&quot;</span>
        <span class="n">type_control</span> <span class="o">=</span> <span class="s2">&quot;no_control&quot;</span>
        <span class="n">type_purge</span> <span class="o">=</span> <span class="s2">&quot;no_purge&quot;</span>
        <span class="n">type_display</span> <span class="o">=</span> <span class="s2">&quot;no_display&quot;</span>
        <span class="n">type_plot</span> <span class="o">=</span> <span class="s2">&quot;fixed&quot;</span>
        <span class="n">type_current</span> <span class="o">=</span> <span class="s2">&quot;polarization_for_cali&quot;</span>
        <span class="n">current_density</span> <span class="o">=</span> <span class="n">polarization_current_for_calibration</span>
        <span class="n">delta_t_ini_step</span> <span class="o">=</span> <span class="mi">120</span> <span class="o">*</span> <span class="mi">60</span>  <span class="c1"># (s). Initial time at zero current density for the stabilisation of the internal states.</span>
        <span class="n">delta_t_load_step</span> <span class="o">=</span> <span class="mf">1e-15</span>  <span class="c1"># (s). Loading time for the step current density function, from 0 to i_step.</span>
        <span class="n">delta_t_break_step</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># (s). Time at i_step current density for the stabilisation of the internal states.</span>
        <span class="n">i_step</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># (A.m-2). Current density for the step current density function.</span>
        <span class="n">step_current_parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;delta_t_ini_step&#39;</span><span class="p">:</span> <span class="n">delta_t_ini_step</span><span class="p">,</span> <span class="s1">&#39;delta_t_load_step&#39;</span><span class="p">:</span> <span class="n">delta_t_load_step</span><span class="p">,</span>
                                   <span class="s1">&#39;delta_t_break_step&#39;</span><span class="p">:</span> <span class="n">delta_t_break_step</span><span class="p">,</span> <span class="s1">&#39;i_step&#39;</span><span class="p">:</span> <span class="n">i_step</span><span class="p">}</span>
        <span class="n">delta_t_ini_pola</span> <span class="o">=</span> <span class="mi">30</span> <span class="o">*</span> <span class="mi">60</span>  <span class="c1"># (s). Initial time at zero current density for the stabilisation of the internal states.</span>
        <span class="n">delta_t_load_pola</span> <span class="o">=</span> <span class="mi">30</span>  <span class="c1"># (s). Loading time for one step current of the polarisation current density function.</span>
        <span class="n">delta_t_break_pola</span> <span class="o">=</span> <span class="mi">15</span> <span class="o">*</span> <span class="mi">60</span>  <span class="c1"># (s). Breaking time for one step current, for the stabilisation of the internal states.</span>
        <span class="n">delta_i_pola</span> <span class="o">=</span> <span class="mf">0.05e4</span>  <span class="c1"># (A.m-2). Current density step for the polarisation current density function.</span>
        <span class="n">i_max_pola</span> <span class="o">=</span> <span class="mf">1.7e4</span>  <span class="c1"># (A.m-2). It is the maximum current density for the polarization curve.</span>
        <span class="n">pola_current_parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;delta_t_ini_pola&#39;</span><span class="p">:</span> <span class="n">delta_t_ini_pola</span><span class="p">,</span> <span class="s1">&#39;delta_t_load_pola&#39;</span><span class="p">:</span> <span class="n">delta_t_load_pola</span><span class="p">,</span>
                                   <span class="s1">&#39;delta_t_break_pola&#39;</span><span class="p">:</span> <span class="n">delta_t_break_pola</span><span class="p">,</span> <span class="s1">&#39;delta_i_pola&#39;</span><span class="p">:</span> <span class="n">delta_i_pola</span><span class="p">,</span>
                                   <span class="s1">&#39;i_max_pola&#39;</span><span class="p">:</span> <span class="n">i_max_pola</span><span class="p">}</span>
        <span class="n">delta_t_ini_pola_cali</span> <span class="o">=</span> <span class="mi">60</span>  <span class="c1"># (s). Initial time at zero current density for the stabilisation of the internal states.</span>
        <span class="n">delta_t_load_pola_cali</span> <span class="o">=</span> <span class="mi">30</span>  <span class="c1"># (s). Loading time for one step current of the polarisation current density function.</span>
        <span class="n">delta_t_break_pola_cali</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="mi">60</span>  <span class="c1"># (s). Breaking time for one step current, for the stabilisation of the internal states.</span>
        <span class="n">pola_current_for_cali_parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;delta_t_ini_pola_cali&#39;</span><span class="p">:</span> <span class="n">delta_t_ini_pola_cali</span><span class="p">,</span>
                                            <span class="s1">&#39;delta_t_load_pola_cali&#39;</span><span class="p">:</span> <span class="n">delta_t_load_pola_cali</span><span class="p">,</span>
                                            <span class="s1">&#39;delta_t_break_pola_cali&#39;</span><span class="p">:</span> <span class="n">delta_t_break_pola_cali</span><span class="p">}</span>
        <span class="n">i_EIS</span><span class="p">,</span> <span class="n">ratio_EIS</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>  <span class="c1"># (A/m², ). i_EIS is the current for which a ratio_EIS perturbation is added.</span>
        <span class="n">f_EIS</span><span class="p">,</span> <span class="n">t_EIS</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>  <span class="c1"># It is the EIS parameters.</span>
        <span class="n">t_purge</span> <span class="o">=</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mi">15</span>  <span class="c1"># s It is the purge time and the distance between two purges.</span>
        <span class="n">n_gdl</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">Hgdl</span> <span class="o">/</span> <span class="n">Hacl</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)</span>  <span class="c1"># It is the number of model points placed inside each GDL.</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;A correct type_fuel_cell should be given.&quot;</span><span class="p">)</span>

    <span class="c1"># Initialize the operating inputs and parameters dictionaries.</span>
    <span class="n">operating_inputs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;current_density&#39;</span><span class="p">:</span> <span class="n">current_density</span><span class="p">,</span> <span class="s1">&#39;T_des&#39;</span><span class="p">:</span> <span class="n">T_des</span><span class="p">,</span> <span class="s1">&#39;Pa_des&#39;</span><span class="p">:</span> <span class="n">Pa_des</span><span class="p">,</span> <span class="s1">&#39;Pc_des&#39;</span><span class="p">:</span> <span class="n">Pc_des</span><span class="p">,</span>
                        <span class="s1">&#39;Sa&#39;</span><span class="p">:</span> <span class="n">Sa</span><span class="p">,</span> <span class="s1">&#39;Sc&#39;</span><span class="p">:</span> <span class="n">Sc</span><span class="p">,</span> <span class="s1">&#39;Phi_a_des&#39;</span><span class="p">:</span> <span class="n">Phi_a_des</span><span class="p">,</span> <span class="s1">&#39;Phi_c_des&#39;</span><span class="p">:</span> <span class="n">Phi_c_des</span><span class="p">}</span>
    <span class="n">current_parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;step_current_parameters&#39;</span><span class="p">:</span> <span class="n">step_current_parameters</span><span class="p">,</span>
                          <span class="s1">&#39;pola_current_parameters&#39;</span><span class="p">:</span> <span class="n">pola_current_parameters</span><span class="p">,</span>
                          <span class="s1">&#39;pola_current_for_cali_parameters&#39;</span><span class="p">:</span> <span class="n">pola_current_for_cali_parameters</span><span class="p">,</span>
                          <span class="s1">&#39;i_EIS&#39;</span><span class="p">:</span> <span class="n">i_EIS</span><span class="p">,</span> <span class="s1">&#39;ratio_EIS&#39;</span><span class="p">:</span> <span class="n">ratio_EIS</span><span class="p">,</span> <span class="s1">&#39;t_EIS&#39;</span><span class="p">:</span> <span class="n">t_EIS</span><span class="p">,</span> <span class="s1">&#39;f_EIS&#39;</span><span class="p">:</span> <span class="n">f_EIS</span><span class="p">}</span>
    <span class="n">accessible_physical_parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Aact&#39;</span><span class="p">:</span> <span class="n">Aact</span><span class="p">,</span> <span class="s1">&#39;Hagc&#39;</span><span class="p">:</span> <span class="n">Hagc</span><span class="p">,</span> <span class="s1">&#39;Hcgc&#39;</span><span class="p">:</span> <span class="n">Hcgc</span><span class="p">,</span> <span class="s1">&#39;Wagc&#39;</span><span class="p">:</span> <span class="n">Wagc</span><span class="p">,</span> <span class="s1">&#39;Wcgc&#39;</span><span class="p">:</span> <span class="n">Wcgc</span><span class="p">,</span> <span class="s1">&#39;Lgc&#39;</span><span class="p">:</span> <span class="n">Lgc</span><span class="p">}</span>
    <span class="n">undetermined_physical_parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Hgdl&#39;</span><span class="p">:</span> <span class="n">Hgdl</span><span class="p">,</span> <span class="s1">&#39;Hmpl&#39;</span><span class="p">:</span> <span class="n">Hmpl</span><span class="p">,</span> <span class="s1">&#39;Hmem&#39;</span><span class="p">:</span> <span class="n">Hmem</span><span class="p">,</span> <span class="s1">&#39;Hacl&#39;</span><span class="p">:</span> <span class="n">Hacl</span><span class="p">,</span> <span class="s1">&#39;Hccl&#39;</span><span class="p">:</span> <span class="n">Hccl</span><span class="p">,</span>
                                        <span class="s1">&#39;epsilon_gdl&#39;</span><span class="p">:</span> <span class="n">epsilon_gdl</span><span class="p">,</span> <span class="s1">&#39;epsilon_mpl&#39;</span><span class="p">:</span> <span class="n">epsilon_mpl</span><span class="p">,</span>
                                        <span class="s1">&#39;epsilon_mc&#39;</span><span class="p">:</span> <span class="n">epsilon_mc</span><span class="p">,</span> <span class="s1">&#39;epsilon_c&#39;</span><span class="p">:</span> <span class="n">epsilon_c</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">:</span> <span class="n">e</span><span class="p">,</span>
                                        <span class="s1">&#39;kappa_co&#39;</span><span class="p">:</span> <span class="n">kappa_co</span><span class="p">,</span> <span class="s1">&#39;i0_c_ref&#39;</span><span class="p">:</span> <span class="n">i0_c_ref</span><span class="p">,</span> <span class="s1">&#39;kappa_c&#39;</span><span class="p">:</span> <span class="n">kappa_c</span><span class="p">,</span>
                                        <span class="s1">&#39;a_slim&#39;</span><span class="p">:</span> <span class="n">a_slim</span><span class="p">,</span> <span class="s1">&#39;b_slim&#39;</span><span class="p">:</span> <span class="n">b_slim</span><span class="p">,</span> <span class="s1">&#39;a_switch&#39;</span><span class="p">:</span> <span class="n">a_switch</span><span class="p">,</span>
                                        <span class="s1">&#39;C_scl&#39;</span><span class="p">:</span> <span class="n">C_scl</span><span class="p">}</span>
    <span class="n">computing_parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;n_gdl&#39;</span><span class="p">:</span> <span class="n">n_gdl</span><span class="p">,</span> <span class="s1">&#39;t_purge&#39;</span><span class="p">:</span> <span class="n">t_purge</span><span class="p">,</span> <span class="s1">&#39;type_fuel_cell&#39;</span><span class="p">:</span> <span class="n">type_fuel_cell</span><span class="p">,</span>
                            <span class="s1">&#39;type_current&#39;</span><span class="p">:</span> <span class="n">type_current</span><span class="p">,</span> <span class="s1">&#39;type_auxiliary&#39;</span><span class="p">:</span> <span class="n">type_auxiliary</span><span class="p">,</span>
                            <span class="s1">&#39;type_control&#39;</span><span class="p">:</span> <span class="n">type_control</span><span class="p">,</span> <span class="s1">&#39;type_purge&#39;</span><span class="p">:</span> <span class="n">type_purge</span><span class="p">,</span> <span class="s1">&#39;type_display&#39;</span><span class="p">:</span> <span class="n">type_display</span><span class="p">,</span>
                            <span class="s1">&#39;type_plot&#39;</span><span class="p">:</span> <span class="n">type_plot</span><span class="p">}</span>

    <span class="c1"># Characteristic points of the experimental polarization curve</span>
    <span class="n">i_exp</span><span class="p">,</span> <span class="n">U_exp</span> <span class="o">=</span> <span class="n">pola_exp_values_calibration</span><span class="p">(</span><span class="n">type_fuel_cell</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">operating_inputs</span><span class="p">,</span> <span class="n">current_parameters</span><span class="p">,</span> <span class="n">accessible_physical_parameters</span><span class="p">,</span> <span class="n">undetermined_physical_parameters</span><span class="p">,</span>
            <span class="n">computing_parameters</span><span class="p">,</span> <span class="n">i_exp</span><span class="p">,</span> <span class="n">U_exp</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="modules.calibration_modules.print_calibration_results" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">print_calibration_results</span><span class="p">(</span><span class="n">convergence</span><span class="p">,</span> <span class="n">ga_instance</span><span class="p">,</span> <span class="n">solution</span><span class="p">,</span> <span class="n">varbound</span><span class="p">,</span> <span class="n">sim_error</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>This function prints the calibration results by associating each optimized value with its parameter name.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>convergence</code></b>
                  (<code>dict</code>)
              –
              <div class="doc-md-description">
                <p>Dictionary containing the convergence information of the genetic algorithm.</p>
              </div>
            </li>
            <li>
              <b><code>ga_instance</code></b>
                  (<code>PyGAD object</code>)
              –
              <div class="doc-md-description">
                <p>Instance of PyGAD used for optimization.</p>
              </div>
            </li>
            <li>
              <b><code>solution</code></b>
                  (<code>list</code>)
              –
              <div class="doc-md-description">
                <p>List of optimized parameter values.</p>
              </div>
            </li>
            <li>
              <b><code>varbound</code></b>
                  (<code>list</code>)
              –
              <div class="doc-md-description">
                <p>List of parameter bounds and names.</p>
              </div>
            </li>
            <li>
              <b><code>sim_error</code></b>
                  (<code>float</code>)
              –
              <div class="doc-md-description">
                <p>Maximum simulation error in percentage.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>modules/calibration_modules.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">print_calibration_results</span><span class="p">(</span><span class="n">convergence</span><span class="p">,</span> <span class="n">ga_instance</span><span class="p">,</span> <span class="n">solution</span><span class="p">,</span> <span class="n">varbound</span><span class="p">,</span> <span class="n">sim_error</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function prints the calibration results by associating each optimized value with its parameter name.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    convergence : dict</span>
<span class="sd">        Dictionary containing the convergence information of the genetic algorithm.</span>
<span class="sd">    ga_instance : PyGAD object</span>
<span class="sd">        Instance of PyGAD used for optimization.</span>
<span class="sd">    solution : list</span>
<span class="sd">        List of optimized parameter values.</span>
<span class="sd">    varbound : list</span>
<span class="sd">        List of parameter bounds and names.</span>
<span class="sd">    sim_error : float</span>
<span class="sd">        Maximum simulation error in percentage.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Convergence:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">convergence</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">solution</span><span class="p">):</span>
        <span class="n">param_name</span> <span class="o">=</span> <span class="n">varbound</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Optimized parameter </span><span class="si">{</span><span class="n">param_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">val</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">Fore</span><span class="o">.</span><span class="n">RED</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Max simulation error: &quot;</span><span class="p">,</span> <span class="n">sim_error</span><span class="p">,</span> <span class="s2">&quot;%&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">Style</span><span class="o">.</span><span class="n">RESET_ALL</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ga_instance</span><span class="o">.</span><span class="n">best_solution_generation</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Best fitness value reached after </span><span class="si">{</span><span class="n">ga_instance</span><span class="o">.</span><span class="n">best_solution_generation</span><span class="si">}</span><span class="s2"> generations.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="modules.calibration_modules.save_calibration_results" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">save_calibration_results</span><span class="p">(</span><span class="n">convergence</span><span class="p">,</span> <span class="n">ga_instance</span><span class="p">,</span> <span class="n">solution</span><span class="p">,</span> <span class="n">varbound</span><span class="p">,</span> <span class="n">sim_error</span><span class="p">,</span> <span class="n">type_fuel_cell</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>This function saves the calibration results in a text file and a PyGAD file.</p>
<p>The optimized values are retrieved from the solution list and associated with their names via varbound.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>convergence</code></b>
                  (<code>dict</code>)
              –
              <div class="doc-md-description">
                <p>Convergence information from the genetic algorithm.</p>
              </div>
            </li>
            <li>
              <b><code>ga_instance</code></b>
                  (<code>PyGAD object</code>)
              –
              <div class="doc-md-description">
                <p>Instance of PyGAD used for optimization.</p>
              </div>
            </li>
            <li>
              <b><code>solution</code></b>
                  (<code>list</code>)
              –
              <div class="doc-md-description">
                <p>List of optimized parameter values.</p>
              </div>
            </li>
            <li>
              <b><code>varbound</code></b>
                  (<code>list</code>)
              –
              <div class="doc-md-description">
                <p>List of parameter bounds and names.</p>
              </div>
            </li>
            <li>
              <b><code>sim_error</code></b>
                  (<code>float</code>)
              –
              <div class="doc-md-description">
                <p>Maximum simulation error in percentage.</p>
              </div>
            </li>
            <li>
              <b><code>type_fuel_cell</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>Type of fuel cell configuration.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code>None</code>
              –
              <div class="doc-md-description">
                
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>modules/calibration_modules.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">save_calibration_results</span><span class="p">(</span><span class="n">convergence</span><span class="p">,</span> <span class="n">ga_instance</span><span class="p">,</span> <span class="n">solution</span><span class="p">,</span> <span class="n">varbound</span><span class="p">,</span> <span class="n">sim_error</span><span class="p">,</span> <span class="n">type_fuel_cell</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function saves the calibration results in a text file and a PyGAD file.</span>

<span class="sd">    The optimized values are retrieved from the solution list and associated with their names via varbound.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    convergence : dict</span>
<span class="sd">        Convergence information from the genetic algorithm.</span>
<span class="sd">    ga_instance : PyGAD object</span>
<span class="sd">        Instance of PyGAD used for optimization.</span>
<span class="sd">    solution : list</span>
<span class="sd">        List of optimized parameter values.</span>
<span class="sd">    varbound : list</span>
<span class="sd">        List of parameter bounds and names.</span>
<span class="sd">    sim_error : float</span>
<span class="sd">        Maximum simulation error in percentage.</span>
<span class="sd">    type_fuel_cell : str</span>
<span class="sd">        Type of fuel cell configuration.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">root_folder</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="s2">&quot;parameter_calibration_1.txt&quot;</span>
    <span class="n">subfolder_name</span> <span class="o">=</span> <span class="n">type_fuel_cell</span><span class="p">[:</span><span class="n">type_fuel_cell</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)]</span> <span class="k">if</span> <span class="n">type_fuel_cell</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="n">type_fuel_cell</span>
    <span class="n">counter</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">folder_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root_folder</span><span class="p">,</span> <span class="n">subfolder_name</span><span class="p">)</span>
    <span class="c1"># Create the folder if necessary</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">folder_name</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">folder_name</span><span class="p">)</span>
    <span class="c1"># Create the file without erasing the previous ones</span>
    <span class="k">while</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder_name</span><span class="p">,</span> <span class="n">filename</span><span class="p">)):</span>
        <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;parameter_calibration_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">counter</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.txt&quot;</span>
    <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder_name</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
    <span class="c1"># Write information</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Convergence: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">convergence</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">solution</span><span class="p">):</span>
            <span class="n">param_name</span> <span class="o">=</span> <span class="n">varbound</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Optimized parameter </span><span class="si">{</span><span class="n">param_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">val</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Max simulation error: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sim_error</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;%&quot;</span><span class="p">)</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Algorithm works with &quot;</span> <span class="o">+</span> <span class="n">type_fuel_cell</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ga_instance</span><span class="o">.</span><span class="n">best_solution_generation</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Best fitness value reached after </span><span class="si">{</span><span class="n">ga_instance</span><span class="o">.</span><span class="n">best_solution_generation</span><span class="si">}</span><span class="s2"> generations.&quot;</span><span class="p">)</span>
    <span class="n">ga_instance</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder_name</span><span class="p">,</span> <span class="s2">&quot;parameter_calibration_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">counter</span><span class="p">)))</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s1">&#39;parameter_calibration_ongoing.pkl&#39;</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;parameter_calibration_ongoing.pkl&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="modules.calibration_modules.update_undetermined_parameters" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_undetermined_parameters</span><span class="p">(</span><span class="n">type_fuel_cell</span><span class="p">,</span> <span class="n">solution</span><span class="p">,</span> <span class="n">varbound</span><span class="p">,</span> <span class="n">undetermined_physical_parameters</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Update the undetermined physical parameters dictionary with values from the solution.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>solution</code></b>
                  (<code>list</code>)
              –
              <div class="doc-md-description">
                <p>List of parameter values obtained from the optimization algorithm.</p>
              </div>
            </li>
            <li>
              <b><code>varbound</code></b>
                  (<code>list</code>)
              –
              <div class="doc-md-description">
                <p>List of parameter bounds and names. Each element contains the parameter name at index 0.</p>
              </div>
            </li>
            <li>
              <b><code>undetermined_physical_parameters</code></b>
                  (<code>dict</code>)
              –
              <div class="doc-md-description">
                <p>Dictionary of undetermined physical parameters to be updated.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code>dict</code>
              –
              <div class="doc-md-description">
                <p>Updated dictionary of undetermined physical parameters.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>modules/calibration_modules.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">update_undetermined_parameters</span><span class="p">(</span><span class="n">type_fuel_cell</span><span class="p">,</span> <span class="n">solution</span><span class="p">,</span> <span class="n">varbound</span><span class="p">,</span> <span class="n">undetermined_physical_parameters</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Update the undetermined physical parameters dictionary with values from the solution.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    solution : list</span>
<span class="sd">        List of parameter values obtained from the optimization algorithm.</span>
<span class="sd">    varbound : list</span>
<span class="sd">        List of parameter bounds and names. Each element contains the parameter name at index 0.</span>
<span class="sd">    undetermined_physical_parameters : dict</span>
<span class="sd">        Dictionary of undetermined physical parameters to be updated.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict</span>
<span class="sd">        Updated dictionary of undetermined physical parameters.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">solution</span><span class="p">)):</span>
        <span class="n">param_name</span> <span class="o">=</span> <span class="n">varbound</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">param_name</span> <span class="ow">in</span> <span class="n">undetermined_physical_parameters</span><span class="p">:</span>
            <span class="n">undetermined_physical_parameters</span><span class="p">[</span><span class="n">param_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">solution</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">type_fuel_cell</span> <span class="o">==</span> <span class="s2">&quot;EH-31_1.5&quot;</span> <span class="ow">or</span> <span class="n">type_fuel_cell</span> <span class="o">==</span> <span class="s2">&quot;EH-31_2.0&quot;</span> <span class="ow">or</span> <span class="n">type_fuel_cell</span> <span class="o">==</span> <span class="s2">&quot;EH-31_2.25&quot;</span> <span class="ow">or</span> \
            <span class="n">type_fuel_cell</span> <span class="o">==</span> <span class="s2">&quot;EH-31_2.5&quot;</span><span class="p">:</span>
            <span class="n">undetermined_physical_parameters</span><span class="p">[</span><span class="s1">&#39;Hccl&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">undetermined_physical_parameters</span><span class="p">[</span><span class="s1">&#39;Hacl&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">undetermined_physical_parameters</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../auxiliaries_modules/" class="btn btn-neutral float-left" title="Auxiliaries modules"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../dif_eq_modules/" class="btn btn-neutral float-right" title="Differential equations modules">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../auxiliaries_modules/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../dif_eq_modules/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../../..";</script>
    <script src="../../../js/theme_extra.js"></script>
    <script src="../../../js/theme.js"></script>
      <script src="../../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
